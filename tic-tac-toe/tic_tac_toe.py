(h:=lambda b,r,c,p:((0if sum(map(sum,b))==13else 3)if{9*p-6}-{sum(x)*min(x)for x in[b[r],[i[c]for i in b]]+([[b[r][c],b[1][1],b[2-r][2-c]]]if(r,c)!=(1,1)else[[b[0][0],b[1][1],b[2][2]],[b[2][0],b[1][1],b[0][2]]])}else p),l:='*XO',s:=[[0,0,0],[0,0,0],[0,0,0]],t:=lambda b,p:(print('  ABC'),[print(i+1,''.join(map(l.__getitem__,b[i])))for i in range(3)],i:=list(input(f"Place {l[p]}: ")),c:="ABC".index(i[0]),r:=int(i[1])-1,(b[r].__setitem__(c,p),u:=(b,r,c))if b[r][c]==0else(u:=t(b,p)),p:=3-p,u)[7],C:=lambda b,p,v,d,M,S:(F:=sum(b,[]),D:=[(T:=F[:],T.__setitem__(i,p),[T[i:i+3]for i in range(0, 9, 3)])[2]if F[i]==0else 0for i in range(9)],Y:=0,[(e:=m(D[j],j//3,j%3,d-1,p),((v:=e,Y:=(D[j],j//3,j%3))if e>v else 0)if S else(v:=M(v,e)))if D[j]else 0for j in range(9)],Y if S else v)[4],m:=lambda b,r,c,d,p:(f:=h(b,r,c,p),(v:=int('1201021'[f+6-3*g])-1)if d==0 or f!=3 else(v:=-9,v:=C(b,3-p,v,d,max,0>1))if p!=g else(v:=9,v:=C(b,3-p,v,d,min,0>1)),v)[2],g:=l.index(input('X or O: ')),w:=lambda b,r,c,p:(u:=t(b,p)if p==g else(u:=C(b,p,-9,10,max,0<1)),b:=u[0],r:=u[1],c:=u[2],H:=h(b,r,c,p),w(b,r,c,3-p)if H==3else print(['Draw!','X wins!','O wins!'][H]),),w(s,0,0,1))